<!DOCTYPE html> 
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#" lang="en"> 
 <head> 
  <title>Custom AEM Clientlib Markup for HTML5 - Adobe Experience Manager | AEM/CQ | Apache Sling</title> 
  <link href="http://www.nateyolles.com/blog/2016/06/custom-aem-html5-async-clientlibs" rel="canonical" /> 
  <link href="/etc/clientlibs/nateyolles/css/publick-nateyolles.min.css" rel="stylesheet" /> 
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,400,300,600" rel="stylesheet" type="text/css" /> 
  <meta name="msapplication-config" content="/browserconfig.xml" /> 
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png" /> 
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png" /> 
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png" /> 
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png" /> 
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png" /> 
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png" /> 
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png" /> 
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png" /> 
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png" /> 
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" /> 
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" /> 
  <link rel="icon" type="image/png" href="/android-chrome-96x96.png" sizes="96x96" /> 
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" /> 
  <link rel="manifest" href="/manifest.json" /> 
  <meta name="description" content="Create custom HTML output for AEM clientlibs and Sightly to take advantage of HTML5 and enhance site performance." /> 
  <meta name="keywords" content="Adobe Experience Manager,AEM,CQ,clientlib,clientlibs,html5,htmllibrarymanager,async,defer,onload,crossorigin,css,js,sightly" /> 
  <meta name="author" content="Nate Yolles" /> 
  <meta property="og:title" content="Custom AEM Clientlib Markup for HTML5 - Nate Yolles - Adobe Experience Manager" /> 
  <meta property="og:type" content="article" /> 
  <meta property="article:published_time" content="2016-06-01" /> 
  <meta property="article:modified_time" content="2016-06-01" /> 
  <meta property="article:author" content="Nate Yolles" /> 
  <meta property="article:section" content="Technology" /> 
  <meta property="article:tag" content="Adobe Experience Manager" /> 
  <meta property="article:tag" content="AEM" /> 
  <meta property="article:tag" content="CQ5" /> 
  <meta property="article:tag" content="clientlib" /> 
  <meta property="article:tag" content="clientlibs" /> 
  <meta property="article:tag" content="html5" /> 
  <meta property="article:tag" content="htmllibrarymanager" /> 
  <meta property="article:tag" content="async" /> 
  <meta property="article:tag" content="defer" /> 
  <meta property="article:tag" content="onload" /> 
  <meta property="article:tag" content="crossorigin" /> 
  <meta property="article:tag" content="css" /> 
  <meta property="article:tag" content="js" /> 
  <meta property="article:tag" content="sightly" /> 
  <meta property="og:url" content="http://www.nateyolles.com/blog/2016/06/custom-aem-html5-async-clientlibs" /> 
  <meta property="og:image" content="http://www.nateyolles.com/assets/images/aem-clientlib-custom-html5-markup.png" /> 
  <meta property="og:description" content="Create custom HTML output for AEM clientlibs and Sightly to take advantage of HTML5 and enhance site performance." /> 
  <meta name="twitter:card" content="summary_large_image" /> 
  <meta name="twitter:site" content="@nateyolles" /> 
  <meta name="twitter:creator" content="@nateyolles" /> 
  <meta name="twitter:title" content="Custom AEM Clientlib Markup for HTML5 - Nate Yolles - Adobe Experience Manager" /> 
  <meta name="twitter:description" content="Create custom HTML output for AEM clientlibs and Sightly to take advantage of HTML5 and enhance site performance." /> 
  <meta name="twitter:image" content="http://www.nateyolles.com/assets/images/aem-clientlib-custom-html5-markup.png" /> 
  <meta charset="utf-8" /> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" /> 
 </head> 
 <body data-spy="scroll" data-target="#navigation" data-offset="75"> 
  <section id="navigation"> 
   <div class="navbar navbar-default navbar-static-top sticky" role="navigation"> 
    <div class="container"> 
     <div class="navbar-header"> 
      <form>
       <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
       <a class="navbar-brand" href="/">Nate Yolles</a> 
      </form>
     </div> 
     <div class="navbar-collapse collapse"> 
      <ul class="nav navbar-nav navbar-right scrollto"> 
       <li><a href="/#home">Home</a></li> 
       <li><a href="/#about">About</a></li> 
       <li><a href="/#skills">Skills</a></li> 
       <li><a href="/#work">Work</a></li> 
       <li><a href="/#projects">projects</a></li> 
       <li><a href="/#contact">Contact</a></li> 
       <li><a href="/blog">Blog</a></li> 
      </ul> 
     </div> 
    </div> 
   </div> 
  </section> 
  <section id="page-head-bg" style="background-image: url('/assets/images/aem-clientlib-custom-html5-markup.png');" class="parallax" data-stellar-background-ratio=".5"> 
   <div class="container"> 
    <h1><span class="post-heading">Custom AEM Clientlib Markup for HTML5</span></h1> 
    <h2><span class="post-heading">Adobe Experience Manager | AEM/CQ | Apache Sling</span></h2> 
   </div> 
  </section> 
  <section id="blog-post" class="padding-80"> 
   <div class="container"> 
    <div class="row"> 
     <div class="col-md-9"> 
      <div class="blog-item-sec"> 
       <div class="blog-item-head"> 
        <h3>Custom AEM Clientlib Markup for HTML5</h3> 
       </div> 
       <div class="blog-item-post-info"> 
        <span class="scrollto">Nate Yolles | June 01, 2016 | <a href="#comments" class="blog-view-comments">1003 comments</a> |</span> 
       </div> 
       <div class="blog-item-post-desc"> 
        <div>
         AEM clientlibs are extremely powerful. They allow you to produce client-side JavaScript and CSS libraries while controlling minification, concatenation, and dependency management. However, out-of-the-box, they don't allow you to customize the HTML output. While optimizing your website for speed, you may want to use the 
         <code>defer</code>, 
         <code>async</code>, and/or 
         <code>onload</code> attributes on your 
         <code>script</code> elements. Likewise, while managing your cross-origin resource sharing (CORS) HTTP requests, you may want to utilize the 
         <code>crossorigin</code> attribute on your 
         <code>script</code> and/or 
         <code>link</code> elements for JavaScript and CSS.
        </div> 
        <div>
         <br />
        </div> 
        <div>
         <a href="https://github.com/nateyolles/aem-clientlib-async" target="_blank">Download project from GitHub</a>
        </div> 
        <div>
         <br />
        </div> 
        <div>
         Using clientlibs in AEM with 
         <a href="https://github.com/Adobe-Marketing-Cloud/sightly-spec/blob/master/SPECIFICATION.md" target="_blank">Sightly</a> is demonstrated in the AEM documentation 
         <a href="https://docs.adobe.com/docs/en/aem/6-2/develop/the-basics/clientlibs.html" target="_blank">Using Client-Side Libraries</a>, as well as Feike Visser's (
         <a href="https://twitter.com/heervisscher" target="_blank">@heervisscher</a>) 
         <a href="http://blogs.adobe.com/experiencedelivers/" target="_blank">Sightly intro part 5: FAQ</a>.
        </div> 
        <div>
         <br />
        </div> 
        <div>
         <code class="gist" data-gist-id="df2f68ba4216c14ecac189c585d60f6d" data-gist-file="" data-gist-hide-line-numbers="false" data-gist-hide-footer="false" data-gist-show-loading="true" data-gist-show-spinner="false"></code>
         <br />
        </div> 
        <div>
         <br />
        </div> 
        <div>
         When we follow the data-sly-use block's expression value in our AEM instance, we find three files that work together with the 
         <a href="https://docs.adobe.com/docs/en/aem/6-2/develop/ref/javadoc/com/adobe/granite/ui/clientlibs/HtmlLibraryManager.html" target="_blank">HtmlLibraryManager</a> to provide the final clientlib output. 
         <code>clientlib.html</code> contains named Sightly template blocks (
         <code>js</code>, 
         <code>css</code>, 
         <code>all</code>), which in turn set the proper Sightly expression option for mode and call the named Sightly templates in 
         <code>graniteClientLib.html</code>. 
         <code>graniteClientLib.html</code> then sets the proper Sightly expression options and delegates the more complex logic to a Java-Use API POJO. 
         <code>ClientLibUseObject.java</code> then utilizes the 
         <code>HtmlLibraryManager</code> in order to write out the final HTML markup.
        </div> 
        <div>
         <br />
        </div> 
        <div>
         All files associated with Sightly clientlibs are viewable in your AEM instance under the 
         <code>/libs/granite/sightly/templates</code> node. To make any alterations, we simply copy all three files out of 
         <code>/libs</code> into 
         <code>/apps</code>, update the files, and update our Sightly components to point to the new clientlib component (usually 
         <code>headlibs.html</code> or similar partial in the page component).
        </div> 
        <div>
         <br />
        </div> 
        <div>
         <code class="gist" data-gist-id="c4c1583fdd686781a20f7532ce0a7149" data-gist-file="" data-gist-hide-line-numbers="false" data-gist-hide-footer="false" data-gist-show-loading="true" data-gist-show-spinner="false"></code>
         <br />
        </div> 
        <div>
         <br />
        </div> 
        <div>
         In our case, we want to alter the HTML markup by adding additional attributes to the script and link elements. In order to do that, we first add additional Sightly expression options to all the Sightly templates. In this example, I'm using 
         <code>loading</code>, 
         <code>onload</code>, and 
         <code>crossorigin</code> options.
        </div> 
        <div>
         <br />
        </div> 
        <div>
         <code class="gist" data-gist-id="8b55b23d2245f7bd6079448b7f1e4d49" data-gist-file="" data-gist-hide-line-numbers="false" data-gist-hide-footer="false" data-gist-show-loading="true" data-gist-show-spinner="false"></code>
         <br />
        </div> 
        <div>
         <br />
        </div> 
        <div>
         Once the new Sightly expression options are set, the Java-Use POJO is updated to obtain those options from the provided bindings. AEM hands the responsibility of printing the final HTML markup to the 
         <code>HtmlLibraryManager</code>'s 
         <code>writeIncludes</code>, 
         <code>writeCssInclude</code> and 
         <code>writeJsInclude</code> methods. However, since we want custom markup, we need to do that ourselves in the POJO.
        </div> 
        <div>
         <br />
        </div> 
        <div>
         <code class="gist" data-gist-id="8299b134c2b56faec93326212e293972" data-gist-file="" data-gist-hide-line-numbers="false" data-gist-hide-footer="false" data-gist-show-loading="true" data-gist-show-spinner="false"></code>
         <br />
        </div> 
        <div>
         <br />
        </div> 
        <div>
         I've written a demonstration AEM project as well provided the code which can easily be installed into a single folder for use in your project. There is also an AEM package available for easy install. View the 
         <a href="https://github.com/nateyolles/aem-clientlib-async" target="_blank">AEM Clientlib Async</a> project on GitHub.
        </div> 
       </div> 
       <div class="blog-more-desc"> 
        <div class="row"> 
         <div class="col-sm-6 col-xs-12"> 
          <ul class="list-inline social-colored"> 
           <li class="empty-text">Share:</li> 
           <li><a href="#"><i class="fa logo-l icon-in share" data-toggle="tooltip" title="" data-original-title="LinkedIn" data-placement="top" data-url="http://www.nateyolles.com/blog/2016/06/custom-aem-html5-async-clientlibs" data-title="Custom AEM Clientlib Markup for HTML5" data-summary="Create custom HTML output for AEM clientlibs and Sightly to take advantage of HTML5 and enhance site performance." data-source="nateyolles.com"></i></a></li> 
           <li><a href="#"><i class="fa logo-t icon-twit share" data-toggle="tooltip" title="" data-original-title="Twitter" data-placement="top" data-text="Custom AEM Clientlib Markup for HTML5" data-via="nateyolles" data-url="http://www.nateyolles.com/blog/2016/06/custom-aem-html5-async-clientlibs"></i></a></li> 
           <li><a href="#"><i class="fa logo-f icon-f share" data-toggle="tooltip" title="" data-original-title="Facebook" data-placement="top"></i></a></li> 
           <li><a href="#"><i class="fa logo-p icon-plus share" data-url="http://www.nateyolles.com/blog/2016/06/custom-aem-html5-async-clientlibs" data-toggle="tooltip" title="" data-original-title="Google plus" data-placement="top"></i></a></li> 
          </ul> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
     <div class="col-md-3"> 
      <div class="sidebar-box"> 
       <h4>Follow Me</h4> 
       <ul class="list-inline social-colored"> 
        <li><a href="https://www.linkedin.com/in/nateyolles" target="_blank"><i class="fa logo-l icon-in" data-toggle="tooltip" title="" data-original-title="Linkedin" data-placement="top"></i></a></li> 
        <li><a href="https://twitter.com/nateyolles" target="_blank"><i class="fa logo-t icon-twit" data-toggle="tooltip" title="" data-original-title="Twitter" data-placement="top"></i></a></li> 
        <li><a href="https://github.com/nateyolles" target="_blank"><i class="fa logo-g icon-git" data-toggle="tooltip" title="" data-original-title="GitHub" data-placement="top"></i></a></li> 
        <li><a href="http://stackoverflow.com/users/3022863/nateyolles" target="_blank"><i class="fa logo-so icon-so" data-toggle="tooltip" title="" data-original-title="Stack Overflow" data-placement="top"></i></a></li> 
       </ul> 
      </div> 
      <div class="sidebar-box"> 
       <h4>All Blog Posts</h4> 
       <div class="collapsible-blog-list list-group panel"> 
        <a href="#collapsible-data-list-0" class="year list-group-item collapse-toggle collapsed" data-toggle="collapse"> <i class="fa"></i> 2017 </a> 
        <div class="collapse sub-menu" id="collapsible-data-list-0"> 
         <a href="#collapsible-data-list-0-0" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-0"> <i class="fa"></i> 05 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-0-0"> 
          <a class="post list-group-item" title="Sync Crypto Keys across AEM 6.3 instances" href="/blog/2017/05/sharing-crypto-keys-in-aem-63">Sharing Crypto Keys in AEM 6.3</a> 
          <a class="post list-group-item" title="Upgrade to the official OSGi Declarative Services (DS) Annotations from Apache Felix SCR annotations in Adobe Experience Manager (AEM)." href="/blog/2017/05/osgi-declarative-services-annotations-in-aem">Official OSGi Declarative Services Annotations in AEM</a> 
         </div> 
        </div> 
        <a href="#collapsible-data-list-1" class="year list-group-item collapse-toggle collapsed" data-toggle="collapse"> <i class="fa"></i> 2015 </a> 
        <div class="collapse sub-menu" id="collapsible-data-list-1"> 
         <a href="#collapsible-data-list-1-0" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-1"> <i class="fa"></i> 09 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-1-0"> 
          <a class="post list-group-item" title="Introducing the Publick Apache Sling + Sightly blog engine." href="/blog/2015/09/publick-apache-sling-sightly-blog-engine">Publick Apache Sling + Sightly blog engine</a> 
         </div> 
         <a href="#collapsible-data-list-1-1" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-1"> <i class="fa"></i> 10 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-1-1"> 
          <a class="post list-group-item" title="Programmatically read and update OSGi configurations in Adobe Experience Manager and Apache Sling using the ConfigurationAdmin service." href="/blog/2015/10/updating-osgi-configurations-in-aem-and-sling">Programmatically updating OSGi configurations in AEM and Sling</a> 
          <a class="post list-group-item" title="Get the HTML for an AEM resource, component or page" href="/blog/2015/10/get-rendered-html-for-an-aem-resource-or-component">Get the rendered HTML for an AEM resource, component or page</a> 
         </div> 
         <a href="#collapsible-data-list-1-2" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-1"> <i class="fa"></i> 11 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-1-2"> 
          <a class="post list-group-item" title="Proper use of checkboxes in AEM components means creating semantic property types using the Sling Post Servlet." href="/blog/2015/11/aem-checkboxes-using-sling-post-servlet">AEM Checkboxes and Semantic Property Types using the Sling Post Servlet</a> 
         </div> 
         <a href="#collapsible-data-list-1-3" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-1"> <i class="fa"></i> 12 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-1-3"> 
          <a class="post list-group-item" title="Convert an AEM Page, Sling Resource, or JCR Node to JSON using the JsonItemWriter." href="/blog/2015/12/converting-aem-sling-resources-to-json">Converting AEM/Sling Resources to JSON</a> 
         </div> 
        </div> 
        <a href="#collapsible-data-list-2" class="year list-group-item collapse-toggle collapsed" data-toggle="collapse"> <i class="fa"></i> 2016 </a> 
        <div class="collapse sub-menu" id="collapsible-data-list-2"> 
         <a href="#collapsible-data-list-2-0" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-2"> <i class="fa"></i> 01 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-2-0"> 
          <a class="post list-group-item" title="Create a custom replication agent in Adobe Experience Manager to purge Akamai CDN cache." href="/blog/2016/01/aem-akamai-custom-replication-agent">Creating a custom Akamai replication agent in AEM</a> 
          <a class="post list-group-item" title="Create a custom Granite UI adapter to disable the Multifield component." href="/blog/2016/01/aem-custom-granite-ui-adapter">Create a custom Granite UI adapter to disable the Multifield component</a> 
         </div> 
         <a href="#collapsible-data-list-2-1" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-2"> <i class="fa"></i> 02 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-2-1"> 
          <a class="post list-group-item" title="Custom validation in AEM Touch UI dialogs" href="/blog/2016/02/aem-touch-ui-custom-validation">AEM Touch UI Custom Validation</a> 
         </div> 
         <a href="#collapsible-data-list-2-2" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-2"> <i class="fa"></i> 03 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-2-2"> 
          <a class="post list-group-item" title="Use com.adobe.granite.confmgr.ConfMgr in AEM to set multi-tenant, ACL protected, inheritance supplied configurations." href="/blog/2016/03/aem-slash-conf-and-confmgr">AEM /conf and ConfMgr</a> 
         </div> 
         <a href="#collapsible-data-list-2-3" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-2"> <i class="fa"></i> 06 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-2-3"> 
          <a class="post list-group-item" title="Create custom HTML output for AEM clientlibs and Sightly to take advantage of HTML5 and enhance site performance." href="/blog/2016/06/custom-aem-html5-async-clientlibs">Custom AEM Clientlib Markup for HTML5</a> 
         </div> 
         <a href="#collapsible-data-list-2-4" class="month list-group-item collapse-toggle collapsed" data-toggle="collapse" data-parent="#collapsible-data-list-2"> <i class="fa"></i> 07 </a> 
         <div class="collapse sub-menu" id="collapsible-data-list-2-4"> 
          <a class="post list-group-item" title="Use custom Granite render conditions to determine if Touch UI components should display in AEM." href="/blog/2016/07/aem-granite-custom-render-conditions">AEM Granite Custom Render Conditions</a> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
  </section> 
  <section id="footer" class="padding-80"> 
   <div class="container"> 
    <div class="row"> 
     <div class="col-md-6 col-sm-6 copyright"> 
      <span>&copy; 2016 Nate Yolles</span> 
     </div> 
     <div class="col-md-6 col-sm-6 footer-nav">
       Powered by the 
      <a href="https://github.com/nateyolles/publick-sling-blog" target="_blank">Publick Sling + Sightly Blog Engine</a> 
     </div> 
    </div> 
   </div> 
  </section> 
  <a href="#" class="scrollToTop"><i class="fa fa-angle-up"></i></a> 
  <script src="/etc/clientlibs/nateyolles/js/publick-nateyolles.min.js">
  </script> 
  <script src="https://www.google.com/recaptcha/api.js">
  </script> 
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-19714698-1', 'auto');
  ga('send', 'pageview');

  </script>  
 </body>
</html>